# LISON仕様

この文書はLISONの構文と意味を定義します。

LISONはJSONから派生する形式です。つまり、すべてのLISONテキストはJSONテキストとして整形でなければなりません。また、LISONテキストのトップレベルオブジェクトは以下で定義される画像オブジェクトでなければなりません。

## 座標系

画像上の位置は２次元デカルト座標によって指定されます。座標系の原点は画像の左上です。x軸は左から右、y軸は上から下の方向です。単位長の長さは `unit-per-inch` 属性によって指定されます。

座標は長さ２の数値の配列によって表現されます。１つ目の要素がx座標で、２つ目の要素がy座標です。

## 色

色空間はsRGBを使用します。色成分の範囲は０から１です。事前乗算は実施しません。

色は長さ３または４の数値の配列によって表現されます。初めの３つの要素がRGB値で、最後の要素が不透明度です。不透明度が省略された場合は１が補われます。

## 画像

| 属性 | 必須 | 説明 |
|:-:|:-:|:-|
| `width` | 必須 | 画像の横幅 |
| `height` | 必須 | 画像の縦幅 |
| `unit-per-inch` | 必須 | １インチの長さ |
| `editor` | 任意 | エディターを識別する文字列 |
| `pens` | 必須 | ペンの配列 |
| `brushes` | 必須 | ブラシの配列 |
| `shapes` | 必須 | 図形の配列 |

編集ソフトは `edit-annot` 属性を含む画像を出力する際、画像オブジェクトに `editor` 属性を含めるべきです。編集ソフトは `editor` 属性の値が存在しないか認識できない値である場合、画像に含まれる `edit-annot` 属性を無視するべきです。

描画ソフトは描画の際に `editor` 属性の有無や値を使用してはいけません。

ペンとブラシは添え字によって参照されます。

画像は添え字が小さいものから順番に描画されます。

## パターン

パターンは描画の内容を指定します。パターンは単色パターン、線形グラデーション、放射グラデーションのいずれかです。

### 単色パターン

| 属性 | 必須 | 説明 |
|:-:|:-:|:-|
| `type` | 必須 | `"monochrome"` |
| `color` | 必須 | 塗りつぶしの色 |

### 線形グラデーション

| 属性 | 必須 | 説明 |
|:-:|:-:|:-|
| `type` | 必須 | `"linear-gradient"` |
| `point-1` | 必須 | 開始点 |
| `color-1` | 必須 | 開始点での色 |
| `point-2` | 必須 | 終了点 |
| `color-2` | 必須 | 終了点での色 |

### 放射グラデーション

| 属性 | 必須 | 説明 |
|:-:|:-:|:-|
| `type` | 必須 | `"radial-gradient"` |
| `center-1` | 必須 | 開始円の中心 |
| `radius-1` | 必須 | 開始円の半径 |
| `color-1` | 必須 | 開始円での色 |
| `center-2` | 必須 | 終了円の中心 |
| `radius-2` | 必須 | 終了円の半径 |
| `color-2` | 必須 | 終了円での色 |

## ペン

ペンは線を描画する方法を指定します。

| 属性 | 必須 | 説明 |
|:-:|:-:|:-|
| `pattern` | 必須 | 描画のパターン |
| `width` | 必須 | 線の幅 |
| `cap` | 必須 | 線の端のスタイル |
| `join` | 必須 | 線の結合のスタイル |

`cap` の有効な値は `"butt"` `"round"` `"square"` のいずれかです。

`join` の有効な値は `"miter"` `"round"` `"bevel"` のいずれかです。

## ブラシ

ブラシは塗りつぶしの方法を指定します。

| 属性 | 必須 | 説明 |
|:-:|:-:|:-|
| `pattern` | 必須 | 描画のパターン |

## 図形

図形はグループ、曲線、領域のいずれかです。

### グループ

グループは図形のコンテナです。

| 属性 | 必須 | 説明 |
|:-:|:-:|:-|
| `type` | 必須 | `"group"` |
| `content` | 必須 | グループに含まれる図形の配列 |
| `edit-annot` | 任意 | グループの編集方法を示す注釈 |

`edit-annot` 属性の値の形式は編集ソフトが自由に定義することができます。

### 曲線

| 属性 | 必須 | 説明 |
|:-:|:-:|:-|
| `type` | 必須 | `"curve"` |
| `pen` | 必須 | 使用するペンの添え字 |
| `data` | 必須 | 曲線の形状を定義するデータ |

曲線データは開始点で始まり、セグメントが続く配列です。セグメントは

- 直線セグメント `["L", 終点]`
- ２次ベジェ曲線セグメント `["Q", 制御点２, 制御点３]`
- ３次ベジェ曲線セグメント `["C", 制御点２, 制御点３, 制御点４]`

のいずれかです。

### 領域

| 属性 | 必須 | 説明 |
|:-:|:-:|:-|
| `type` | 必須 | `"region"` |
| `pen` | 任意 | 使用するペンの添え字 |
| `brush` | 任意 | 使用するブラシの添え字 |
| `data` | 必須 | 領域の形状を定義するデータ |

領域データは曲線データの配列です。各曲線は暗黙的に閉じられます。塗りつぶしの範囲はEven-Oddルールによって決められます。
